name: Docker build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      -  name: Checkout source
         uses: actions/checkout@v4
      -  name: Setup Node.js
         uses: actions/setup-node@v4
         with:
           node-version: '18.x'
      -  name: Install dependencies
         run: npm install
      -  name: Run tests
         run: npm test
  build-and-push-docker:
    needs: build
    runs-on: ubuntu-latest
    steps:
      -  name: Build and push Docker image
         uses: agahalou96/github-actions-reusable/.github/workflows/main.yml@v1
         with:
           login-server: githubactionsreusableregistry.azurecr.io
         env:
           REGISTRY_USERNAME: ${{ secrets.REGISTRY_USERNAME }}
           REGISTRY_PASSWORD: ${{ secrets.REGISTRY_PASSWORD }}
